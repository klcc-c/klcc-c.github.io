<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"klcc.cc","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="动静分离 在弄清动静分离之前，我们要先明白什么是动，什么是静。 在Web开发中，通常来说，动态资源其实就是指那些后台资源，而静态资源就是指HTML，JavaScript，CSS，img等文件。 一般来说，都需要将动态资源和静态资源分开，将静态资源部署在Nginx上，当一个请求来的时候，如果是静态资源的请求，就直接到nginx配置的静态资源目录下面获取资源，如果是动态资源的请求，nginx利用反向代">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx动静分离">
<meta property="og:url" content="https://klcc.cc/2211e793.html">
<meta property="og:site_name" content="klcc">
<meta property="og:description" content="动静分离 在弄清动静分离之前，我们要先明白什么是动，什么是静。 在Web开发中，通常来说，动态资源其实就是指那些后台资源，而静态资源就是指HTML，JavaScript，CSS，img等文件。 一般来说，都需要将动态资源和静态资源分开，将静态资源部署在Nginx上，当一个请求来的时候，如果是静态资源的请求，就直接到nginx配置的静态资源目录下面获取资源，如果是动态资源的请求，nginx利用反向代">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/gengff/blogimage/raw/master/images/image-20220111040645557.png">
<meta property="og:image" content="https://gitee.com/gengff/blogimage/raw/master/images/image-20220111044404939.png">
<meta property="og:image" content="https://blog.driverzeng.com/zenglaoshi/02.jpg">
<meta property="og:image" content="https://blog.driverzeng.com/zenglaoshi/03.jpg">
<meta property="og:image" content="https://gitee.com/gengff/blogimage/raw/master/images/04.jpg">
<meta property="article:published_time" content="2022-02-15T09:04:39.422Z">
<meta property="article:modified_time" content="2022-02-15T09:22:07.654Z">
<meta property="article:author" content="klcc">
<meta property="article:tag" content="linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/gengff/blogimage/raw/master/images/image-20220111040645557.png">


<link rel="canonical" href="https://klcc.cc/2211e793.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://klcc.cc/2211e793.html","path":"2211e793.html","title":"Nginx动静分离"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Nginx动静分离 | klcc</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?725ad6b586949dd6e89c022fb8d748f7"></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">klcc</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">27</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">21</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">127</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="nav-number">1.</span> <span class="nav-text">动静分离</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Rewrite"><span class="nav-number">2.</span> <span class="nav-text">Rewrite</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Rewrite%E5%9F%BA%E6%9C%AC%E6%A6%82%E8%BF%B0"><span class="nav-number">2.1.</span> <span class="nav-text">Rewrite基本概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rewrite%E8%AF%AD%E6%B3%95"><span class="nav-number">2.2.</span> <span class="nav-text">rewrite语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rewrite%E6%A0%87%E8%AE%B0Flag"><span class="nav-number">2.3.</span> <span class="nav-text">Rewrite标记Flag</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81last%E5%92%8Cbreak%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.3.1.</span> <span class="nav-text">1、last和break的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81redirect%E5%92%8Cpermanent%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.3.2.</span> <span class="nav-text">2、redirect和permanent的区别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTTPS"><span class="nav-number">3.</span> <span class="nav-text">HTTPS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E7%BD%91%E7%AB%99%E5%8A%AB%E6%8C%81"><span class="nav-number">3.1.</span> <span class="nav-text">模拟网站劫持</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E6%AD%A3%E5%B8%B8%E7%9A%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">3.1.1.</span> <span class="nav-text">1、正常的页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E7%BD%91%E7%AB%99%E5%8A%AB%E6%8C%81"><span class="nav-number">3.1.2.</span> <span class="nav-text">2、网站劫持</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86%E6%B5%81%E7%A8%8B"><span class="nav-number">3.2.</span> <span class="nav-text">加密流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%81%E4%B9%A6%E5%AF%B9%E6%AF%94"><span class="nav-number">3.3.</span> <span class="nav-text">证书对比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6"><span class="nav-number">3.4.</span> <span class="nav-text">自签证书</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%81%E4%B9%A6%E5%8A%A0%E8%BD%BD%E5%88%B0%E4%BB%A3%E7%90%86"><span class="nav-number">3.4.0.1.</span> <span class="nav-text">证书加载到代理</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="klcc"
      src="/images/head.jpg">
  <p class="site-author-name" itemprop="name">klcc</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">127</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://klcc.cc/2211e793.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpg">
      <meta itemprop="name" content="klcc">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="klcc">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Nginx动静分离
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
  
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-02-15 17:04:39 / 修改时间：17:22:07" itemprop="dateCreated datePublished" datetime="2022-02-15T17:04:39+08:00">2022-02-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h1><ul>
<li><p>在弄清动静分离之前，我们要先明白什么是动，什么是静。</p>
<p>在Web开发中，通常来说，动态资源其实就是指那些后台资源，而静态资源就是指HTML，JavaScript，CSS，img等文件。</p>
<p>一般来说，都需要将动态资源和静态资源分开，将静态资源部署在Nginx上，当一个请求来的时候，如果是静态资源的请求，就直接到nginx配置的静态资源目录下面获取资源，如果是动态资源的请求，nginx利用反向代理的原理，把请求转发给后台应用去处理，从而实现动静分离。</p>
<p>在使用前后端分离之后，可以很大程度的提升静态资源的访问速度，同时在开过程中也可以让前后端开发并行可以有效的提高开发时间，也可以有些的减少联调时间 。</p>
<span id="more"></span>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">1、创建NFS挂载点（在nfs服务器上进行）</span><br><span class="line">  ①.创建并授权static目录</span><br><span class="line">   [root@<span class="attribute">nfs</span> ~]<span class="comment"># mkdir /static</span></span><br><span class="line">   [root@nfs ~]<span class="comment"># chown -R www.www /static/</span></span><br><span class="line"> </span><br><span class="line">  ②.增加挂载点（编辑/etc/exports配置文件）</span><br><span class="line">   [root@nfs ~]<span class="comment"># vim /etc/exports</span></span><br><span class="line">    /static      <span class="number">172.16.1.0</span>/<span class="number">20</span>(rw,sync,all_squash,anonuid=<span class="number">666</span>,anongid=<span class="number">666</span>)</span><br><span class="line"></span><br><span class="line">  ③.重启nfs服务端</span><br><span class="line">   [root@nfs ~]<span class="comment"># systemctl restart nfs-server</span></span><br><span class="line"></span><br><span class="line">  ④.检查服务端是否正常</span><br><span class="line">   [root@nfs ~]<span class="comment"># showmount -e</span></span><br><span class="line">    /static <span class="number">172.16.1.0</span>/<span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、将web01服务器的静态资源放置于挂载点内（在web01服务器上进行）</span><br><span class="line">  ①.创建目录</span><br><span class="line">   [root@web01 ~]<span class="comment"># mkdir /opt/static</span></span><br><span class="line"></span><br><span class="line">  ②.挂载</span><br><span class="line">   [root@web01 ~]<span class="comment"># mount -t nfs 172.16.1.31:/static /opt/static/</span></span><br><span class="line"></span><br><span class="line">  ③.将项目的静态资源放置于挂载点内</span><br><span class="line">   [root@web01 ~]<span class="comment"># cp -r /opt/bbs/static/* /opt/static/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、挂载到lb01(在代理服务器上进行操作)</span><br><span class="line">  ①.安装nfs-utils </span><br><span class="line">   [root@lb01 ~]<span class="comment"># yum install nfs-utils -y</span></span><br><span class="line">  ②.创建挂载点</span><br><span class="line">   [root@lb01 ~]<span class="comment"># mkdir /opt/static/</span></span><br><span class="line">  ③.挂载</span><br><span class="line">   [root@lb01 ~]<span class="comment"># mount -t nfs 172.16.1.31:/static /opt/static/</span></span><br><span class="line">   [root@lb01 ~]<span class="comment"># df -h</span></span><br><span class="line"></span><br><span class="line">  ④.修改nginx配置文件</span><br><span class="line">   [root@lb01 ~]<span class="comment"># vim /etc/nginx/conf.d/test.conf </span></span><br><span class="line">   [root@lb01 ~]<span class="comment"># cat /etc/nginx/conf.d/test.conf  </span></span><br><span class="line">upstream bbs &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">172.16.1.7:80</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">3s</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">172.16.1.8:80</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">3s</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">172.16.1.9:80</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> bbs.test.com;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://bbs;</span><br><span class="line">        <span class="attribute">proxy_next_upstream</span> <span class="literal">error</span> timeout invalid_header http_500 http_502 http_503 http_404; </span><br><span class="line">        <span class="attribute">include</span> /etc/nginx/proxy_params;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /static &#123;</span><br><span class="line">        <span class="attribute">alias</span> /opt/static;   </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  ⑤.测试重载<span class="attribute">nginx</span></span><br><span class="line">   [root@lb01 ~]<span class="comment"># nginx -t</span></span><br><span class="line">   [root@lb01 ~]<span class="comment"># systemctl restart nginx</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、测试</span><br><span class="line"> 浏览器访问：bbs.test.com</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Rewrite"><a href="#Rewrite" class="headerlink" title="Rewrite"></a>Rewrite</h1><ul>
<li>Rewrite主要实现url地址重写，以及重定向，就是把传入web的请求重定向到其他url的过程。</li>
</ul>
<h2 id="Rewrite基本概述"><a href="#Rewrite基本概述" class="headerlink" title="Rewrite基本概述"></a>Rewrite基本概述</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.地址跳转，用户访问www.linux.com这个URL是，将其定向至一个新的域名www.baidu.com。</span><br><span class="line">2.协议跳转，用户通过http协议请求网站时，将其重新跳转至https协议方式。</span><br><span class="line">3.伪静态，将动态页面显示为静态页面方式的一种技术，便于搜索引擎的录入，同时建上动态URL地址对外暴露过多的参数，提升更高的安全性。</span><br><span class="line">4.搜索引擎，SEO优化依赖于url路径，好记的url便于搜索引擎录入。</span><br></pre></td></tr></table></figure>

<h2 id="rewrite语法"><a href="#rewrite语法" class="headerlink" title="rewrite语法"></a>rewrite语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Syntax: rewrite regex replacement [flag];</span><br><span class="line">Default:    —</span><br><span class="line">Context:    server, location, <span class="keyword">if</span></span><br><span class="line"> </span><br><span class="line">rewrite         <span class="comment"># 模块命令</span></span><br><span class="line">regex           <span class="comment"># 请求的链接（支持正则表达式）</span></span><br><span class="line">replacement     <span class="comment"># 跳转的链接</span></span><br><span class="line">[flag];         <span class="comment"># 标签</span></span><br><span class="line"> </span><br><span class="line">location /download/ &#123;</span><br><span class="line">    rewrite ^(/download/.*)/media/(.*)\..*$ <span class="variable">$1</span>/mp3/<span class="variable">$2</span>.mp3 <span class="built_in">break</span>;</span><br><span class="line">    rewrite ^(/download/.*)/audio/(.*)\..*$ <span class="variable">$1</span>/mp3/<span class="variable">$2</span>.ra  <span class="built_in">break</span>;</span><br><span class="line">    <span class="built_in">return</span>  403;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Rewrite标记Flag"><a href="#Rewrite标记Flag" class="headerlink" title="Rewrite标记Flag"></a>Rewrite标记Flag</h2><ul>
<li>rewrite指令根据表达式来重定向URL，或者修改字符串，可以应用于server，location，if环境下，每行rewrite指令最后跟一个flag标记，支持的flag标记有如下表格所示：</li>
</ul>
<table>
<thead>
<tr>
<th>flag</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>last</td>
<td>本条规则匹配完成后，停止匹配，不再匹配后面的规则</td>
</tr>
<tr>
<td>break</td>
<td>本条规则匹配完成后，停止匹配，不再匹配后面的规则</td>
</tr>
<tr>
<td>redirect</td>
<td>返回302临时重定向，地址栏会显示跳转后的地址</td>
</tr>
<tr>
<td>permanent</td>
<td>返回301永久重定向，地址栏会显示跳转后的地址</td>
</tr>
</tbody></table>
<h3 id="1、last和break的区别"><a href="#1、last和break的区别" class="headerlink" title="1、last和break的区别"></a>1、last和break的区别</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="attribute">lb01</span> ~]<span class="comment"># cat /etc/nginx/conf.d/rewrite.conf </span></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ ^/break</span> &#123;</span><br><span class="line">        <span class="attribute">rewrite</span> (.*) /test <span class="literal">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ ^/last</span> &#123;</span><br><span class="line">        <span class="attribute">rewrite</span> (.*) /test <span class="literal">last</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /test &#123;</span><br><span class="line">        <span class="attribute">default_type</span> text/html;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">break</span> 只要匹配到规则，则会去本地配置路径的目录中寻找请求的文件；</span><br><span class="line">而<span class="literal">last</span>只要匹配到规则，会对其所在的server(...)标签重新发起请求。</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="literal">break</span>请求：</span><br><span class="line"><span class="number">1</span>.请求linux.rewrite.com/break</span><br><span class="line"><span class="number">2</span>.匹配 location <span class="regexp">~ ^/break</span> 会跳转到 linux.rewrite.com/test</span><br><span class="line"><span class="number">3</span>.请求跳转后，回去查找本地站点目录下的 /test</span><br><span class="line"><span class="number">4</span>.如果找到了，则返回/code/test/index.html的内容；</span><br><span class="line"><span class="number">5</span>.如果没找到该目录则报错<span class="number">404</span>，如果找到该目录没找到对应的文件则<span class="number">403</span></span><br><span class="line"> </span><br><span class="line"><span class="literal">last</span>请求:</span><br><span class="line"><span class="number">1</span>.请求linux.rewrite.com/last</span><br><span class="line"><span class="number">2</span>.匹配 location <span class="regexp">~ ^/last</span> 会跳转到 linux.rewrite.com/test</span><br><span class="line"><span class="number">3</span>.如果找到了，则返回/code/test/index.html的内容；</span><br><span class="line"><span class="number">4</span>.如果没有找到，会重新对当前server发起请求，这个时候访问地址就变成 linux.rewrite.com/test</span><br><span class="line"><span class="number">5</span>.重新请求server会匹配到 location /test/ 直接返回该location的内容</span><br><span class="line"><span class="number">6</span>.如果也没有location匹配，再返回<span class="number">404</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2、redirect和permanent的区别"><a href="#2、redirect和permanent的区别" class="headerlink" title="2、redirect和permanent的区别"></a>2、redirect和permanent的区别</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">重定向</span><br><span class="line"><span class="attribute">location</span> /redirect &#123;</span><br><span class="line">	<span class="attribute">rewrite</span> (.*) http://www.baidu.com <span class="literal">redirect</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /permanent &#123;</span><br><span class="line">    <span class="attribute">rewrite</span> (.*) http://www.baidu.com <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br><span class="line">redirect: 每次请求都会询问服务器，如果当服务器不可用时，则会跳转失败。</span><br><span class="line">permanent: 第一次请求会询问，浏览器会记录跳转的地址，第二次则不再询问服务器，直接通过浏览器缓存的地址跳转。</span><br></pre></td></tr></table></figure>

<h1 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h1><ul>
<li><p>为什么需要使用HTTPS，因为HTTP不安全，当我们使用http网站时，会遭到劫持和篡改，如果采用https协议，那么数据在传输过程中是加密的，所以黑客无法窃取或者篡改数据报文信息，同时也避免网站传输时信息泄露。</p>
</li>
<li><p>那么我们在实现https时，需要了解ssl协议，但我们现在使用的更多的是TLS加密协议。</p>
</li>
<li><p>那么TLS是怎么保证明文消息被加密的呢？在OSI七层模型中，应用层是http协议，那么在应用层协议之下，我们的表示层，是ssl协议所发挥作用的一层，他通过（握手、交换秘钥、告警、加密）等方式，是应用层http协议没有感知的情况下做到了数据的安全加密</p>
</li>
</ul>
<h2 id="模拟网站劫持"><a href="#模拟网站劫持" class="headerlink" title="模拟网站劫持"></a>模拟网站劫持</h2><h3 id="1、正常的页面"><a href="#1、正常的页面" class="headerlink" title="1、正常的页面"></a>1、正常的页面</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.新建html文件</span></span><br><span class="line">[root@web01 ~]<span class="comment"># mkdir /opt/code</span></span><br><span class="line">[root@web01 ~]<span class="comment"># cd /opt/code</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim index.html</span></span><br><span class="line"><span class="comment">#复制粘贴下方内容</span></span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html xmlns=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="line">&lt;title&gt;学生信息注册页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;学生信息注册&lt;/h3&gt;</span><br><span class="line">&lt;form  name=<span class="string">&quot;stu&quot;</span>action=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">  &lt;tr&gt;&lt;td&gt;姓名:&lt;/td&gt;&lt;td&gt;&lt;input <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span>name=<span class="string">&quot;stuName&quot;</span>/&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">  &lt;tr&gt;&lt;td&gt;性别:&lt;/td&gt;</span><br><span class="line">      &lt;td&gt;&lt;input <span class="built_in">type</span>=<span class="string">&quot;radio&quot;</span>name=<span class="string">&quot;stuSex&quot;</span>checked=<span class="string">&quot;checked&quot;</span>&gt;男</span><br><span class="line">          &lt;input <span class="built_in">type</span>=<span class="string">&quot;radio&quot;</span>name=<span class="string">&quot;stuSex&quot;</span>&gt;女</span><br><span class="line">          &lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">   &lt;tr&gt;&lt;td&gt;出生日期&lt;/td&gt;</span><br><span class="line">       &lt;td&gt;&lt;input <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span>name=<span class="string">&quot;stuBirthday&quot;</span>&gt;&lt;/td&gt;</span><br><span class="line">       &lt;td&gt;按格式yyyy-mm-dd&lt;/td&gt;</span><br><span class="line">       &lt;/tr&gt;</span><br><span class="line">       &lt;tr&gt;&lt;td&gt;学校:&lt;/td&gt;&lt;td&gt;&lt;input <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span>name=<span class="string">&quot;stuSchool&quot;</span>&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">       &lt;tr&gt;&lt;td&gt;专业:&lt;/td&gt;</span><br><span class="line">           &lt;td&gt;&lt;select name=<span class="string">&quot;stuSelect2&quot;</span>&gt;</span><br><span class="line">               &lt;option selected&gt;计算机科学与技术&lt;/option&gt;</span><br><span class="line">               &lt;option&gt;网络工程&lt;/option&gt;</span><br><span class="line">               &lt;option&gt;物联网工程&lt;/option&gt;</span><br><span class="line">               &lt;option&gt;应用数学&lt;/option&gt;</span><br><span class="line">               &lt;/select&gt;</span><br><span class="line">               &lt;/td&gt;</span><br><span class="line">               &lt;/tr&gt;</span><br><span class="line">               &lt;tr&gt;&lt;td&gt;体育特长:&lt;/td&gt;</span><br><span class="line">                   &lt;td colspan=<span class="string">&quot;2&quot;</span>&gt;</span><br><span class="line">                      &lt;input <span class="built_in">type</span>=<span class="string">&quot;checkbox&quot;</span>name=<span class="string">&quot;stuCheck&quot;</span> &gt;篮球</span><br><span class="line">                      &lt;input <span class="built_in">type</span>=<span class="string">&quot;checkbox&quot;</span>name=<span class="string">&quot;stuCheck&quot;</span> &gt;足球</span><br><span class="line">                      &lt;input <span class="built_in">type</span>=<span class="string">&quot;checkbox&quot;</span>name=<span class="string">&quot;stuCheck&quot;</span> &gt;排球</span><br><span class="line">                      &lt;input <span class="built_in">type</span>=<span class="string">&quot;checkbox&quot;</span>name=<span class="string">&quot;stuCheck&quot;</span> &gt;游泳</span><br><span class="line">                   &lt;/td&gt; </span><br><span class="line">               &lt;/tr&gt;</span><br><span class="line">               &lt;tr&gt;&lt;td&gt;上传照片:&lt;/td&gt;&lt;td colspan=<span class="string">&quot;2&quot;</span>&gt;&lt;input <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span> &gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">               &lt;tr&gt;&lt;td&gt;密码:&lt;/td&gt;&lt;td&gt;&lt;input <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span>name=<span class="string">&quot;stuPwd&quot;</span> &gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">               &lt;tr&gt;&lt;td&gt;个人介绍:&lt;/td&gt;</span><br><span class="line">                   &lt;td colspan=<span class="string">&quot;2&quot;</span>&gt;&lt;textarea name=<span class="string">&quot;Letter&quot;</span>rows=<span class="string">&quot;4&quot;</span>cols=<span class="string">&quot;40&quot;</span>&gt;&lt;/textarea&gt;&lt;/td&gt;</span><br><span class="line">               &lt;/tr&gt;</span><br><span class="line">               &lt;tr&gt;</span><br><span class="line">                 &lt;td&gt;&lt;input <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span>value=<span class="string">&quot;提交&quot;</span> &gt;&lt;input <span class="built_in">type</span>=<span class="string">&quot;reset&quot;</span>value=<span class="string">&quot;取消&quot;</span> &gt;&lt;/td&gt;</span><br><span class="line">                 &lt;/tr&gt;</span><br><span class="line">                 &lt;/table&gt;</span><br><span class="line">                 &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.压缩下之前web01的配置，没有可以忽略</span></span><br><span class="line">[root@web01 ~]<span class="comment"># gzip /etc/nginx/conf.d/game.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.创建新的配置文件</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/nginx/conf.d/http.conf</span></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name _;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /opt/code;</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.测试重载nginx</span></span><br><span class="line">[root@web01 ~]<span class="comment"># nginx -t</span></span><br><span class="line">[root@web01 ~]<span class="comment"># systemctl restart nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.浏览器访问：http://192.168.15.8/</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/gengff/blogimage/raw/master/images/image-20220111040645557.png" alt="image-20220111040645557"></p>
<h3 id="2、网站劫持"><a href="#2、网站劫持" class="headerlink" title="2、网站劫持"></a>2、网站劫持</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将之前的nginx代理负载均衡配置压缩（没有可忽略该操作）</span></span><br><span class="line">[root@lb01 ~]<span class="comment"># gzip /etc/nginx/conf.d/test.conf </span></span><br><span class="line"><span class="comment"># 创建新的nginx配置文件</span></span><br><span class="line">[root@lb01 ~]<span class="comment"># vim /etc/nginx/conf.d/http.conf </span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name _;</span><br><span class="line"> </span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://192.168.15.8;</span><br><span class="line">     </span><br><span class="line">        sub_filter <span class="string">&#x27;&lt;title&gt;学生信息注册页面&lt;/title&gt;&#x27;</span> <span class="string">&#x27;&lt;title&gt;澳门首家线上赌场&lt;/title&gt;&#x27;</span>;</span><br><span class="line">        sub_filter <span class="string">&#x27;&lt;h3 align=&quot;center&quot;&gt;学生信息注册&lt;/h3&gt;&#x27;</span> <span class="string">&#x27;&lt;h3 align=&quot;center&quot;&gt;VIP用户信息注册&lt;/h3&gt;&#x27;</span>;</span><br><span class="line">        sub_filter <span class="string">&#x27;&lt;tr&gt;&lt;td&gt;性别:&lt;/td&gt;&#x27;</span> <span class="string">&#x27;&lt;tr&gt;&lt;td&gt;爱好:&lt;/td&gt;&#x27;</span>;</span><br><span class="line">        sub_filter <span class="string">&#x27;&lt;option selected&gt;计算机科学与技术&lt;/option&gt;&#x27;</span> <span class="string">&#x27;&lt;option selected&gt;按摩&lt;/option&gt;&#x27;</span>;</span><br><span class="line">        sub_filter <span class="string">&#x27;&lt;option&gt;网络工程&lt;/option&gt;&#x27;</span> <span class="string">&#x27;&lt;option&gt;抽烟&lt;/option&gt;&#x27;</span>;</span><br><span class="line">        sub_filter <span class="string">&#x27;&lt;option&gt;物联网工程&lt;/option&gt;&#x27;</span> <span class="string">&#x27;&lt;option&gt;喝酒&lt;/option&gt;&#x27;</span>;</span><br><span class="line">        sub_filter <span class="string">&#x27;&lt;option&gt;应用数学&lt;/option&gt;&#x27;</span> <span class="string">&#x27;&lt;option&gt;烫头&lt;/option&gt;&#x27;</span>;</span><br><span class="line">        sub_filter <span class="string">&#x27;&lt;tr&gt;&lt;td&gt;上传照片:&lt;/td&gt;&lt;td colspan=&quot;2&quot;&gt;&lt;input type=&quot;file&quot; &gt;&lt;/td&gt;&lt;/tr&gt;&#x27;</span> <span class="string">&#x27;&lt;img src=&quot;https://blog.driverzeng.com/zenglaoshi/xingganheguan.gif&quot;&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启nginx服务 </span></span><br><span class="line">[root@lb01 ~]<span class="comment"># systemctl restart nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">浏览器访问：http://192.168.15.5/</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/gengff/blogimage/raw/master/images/image-20220111044404939.png" alt="image-20220111044404939"></p>
<h2 id="加密流程"><a href="#加密流程" class="headerlink" title="加密流程"></a>加密流程</h2><ul>
<li>1、浏览器发起往服务器的443端口发起请求，请求携带了浏览器支持的加密算法和哈希算法。 </li>
<li>2、服务器收到请求，选择浏览器支持的加密算法和哈希算法。 </li>
<li>3、服务器下将数字证书返回给浏览器，这里的数字证书可以是向某个可靠机构申请的，也可以是自制的。 </li>
<li>4、浏览器进入数字证书认证环节，这一部分是浏览器内置的TLS完成的：<ul>
<li>4.1 首先浏览器会从内置的证书列表中索引，找到服务器下发证书对应的机构，如果没有找到，此时就会提示用户该证书是不是由权威机构颁发，是不可信任的。如果查到了对应的机构，则取出该机构颁发的公钥。 </li>
<li>4.2 用机构的证书公钥解密得到证书的内容和证书签名，内容包括网站的网址、网站的公钥、证书的有效期等。浏览器会先验证证书签名的合法性（验证过程类似上面Bob和Susan的通信）。签名通过后，浏览器验证证书记录的网址是否和当前网址是一致的，不一致会提示用户。如果网址一致会检查证书有效期，证书过期了也会提示用户。这些都通过认证时，浏览器就可以安全使用证书中的网站公钥了。 </li>
<li>4.3 浏览器生成一个随机数R，并使用网站公钥对R进行加密。</li>
</ul>
</li>
<li>5、浏览器将加密的R传送给服务器。 </li>
<li>6、服务器用自己的私钥解密得到R。 </li>
<li>7、服务器以R为密钥使用了对称加密算法加密网页内容并传输给浏览器。 </li>
<li>8、浏览器以R为密钥使用之前约定好的解密算法获取网页内容。</li>
</ul>
<h2 id="证书对比"><a href="#证书对比" class="headerlink" title="证书对比"></a>证书对比</h2><table>
<thead>
<tr>
<th>对比</th>
<th>域名型 DV</th>
<th>企业型 OV</th>
<th>增强型 EV</th>
</tr>
</thead>
<tbody><tr>
<td>绿色地址栏</td>
<td><img src="https://blog.driverzeng.com/zenglaoshi/02.jpg" alt="img">小锁标记+https</td>
<td><img src="https://blog.driverzeng.com/zenglaoshi/03.jpg" alt="img">小锁标记+https</td>
<td><img src="https://gitee.com/gengff/blogimage/raw/master/images/04.jpg" alt="img">小锁标记+企业名称+https</td>
</tr>
<tr>
<td>一般用途</td>
<td>个人站点和应用； 简单的https加密需求</td>
<td>电子商务站点和应用； 中小型企业站点</td>
<td>大型金融平台； 大型企业和政府机构站点</td>
</tr>
<tr>
<td>审核内容</td>
<td>域名所有权验证</td>
<td>全面的企业身份验证； 域名所有权验证</td>
<td>最高等级的企业身份验证； 域名所有权验证</td>
</tr>
<tr>
<td>颁发时长</td>
<td>10分钟-24小时</td>
<td>3-5个工作日</td>
<td>5-7个工作日</td>
</tr>
<tr>
<td>单次申请年限</td>
<td>1年</td>
<td>1-2年</td>
<td>1-2年</td>
</tr>
<tr>
<td>赔付保障金</td>
<td>——</td>
<td>125-175万美金</td>
<td>150-175万美金</td>
</tr>
</tbody></table>
<h2 id="自签证书"><a href="#自签证书" class="headerlink" title="自签证书"></a>自签证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@web01 ~]<span class="comment"># cd /etc/nginx/</span></span><br><span class="line">[root@web01 nginx]<span class="comment"># mkdir ssl_key</span></span><br><span class="line">[root@web01 nginx]<span class="comment"># cd ssl_key</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用openssl命令充当CA权威机构创建证书（生产不使用此方式生成证书，不被互联网认可的黑户证书）</span></span><br><span class="line">[root@web01 ssl_key]<span class="comment"># openssl genrsa -idea -out server.key 2048</span></span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">..............+++</span><br><span class="line">..................................+++</span><br><span class="line"></span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> server.key: 123456</span><br><span class="line">Verifying - Enter pass phrase <span class="keyword">for</span> server.key: 123456</span><br><span class="line"> </span><br><span class="line">[root@web01 ssl_key]<span class="comment"># ll</span></span><br><span class="line">total 4</span><br><span class="line">-rw-r--r--. 1 root root 1739 Dec  9 11:27 server.key</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成自签证书(公钥)，同时去掉私钥的密码</span></span><br><span class="line">[root@web01 ssl_key]<span class="comment"># openssl req -days 36500 -x509 -sha256 -nodes -newkey rsa:2048 -keyout server.key -out server.crt</span></span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">.....................................+++ </span><br><span class="line">............+++</span><br><span class="line">writing new private key to <span class="string">&#x27;server.key&#x27;</span></span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:china       </span><br><span class="line">string is too long, it needs to be less than  2 bytes long</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:meiguo</span><br><span class="line">Locality Name (eg, city) [Default City]:riben</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:heishoudang</span><br><span class="line">Organizational Unit Name (eg, section) []:oldboy</span><br><span class="line">Common Name (eg, your name or your server<span class="string">&#x27;s hostname) []:oldboy</span></span><br><span class="line"><span class="string">Email Address []:123@qq.com</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"># req  --&gt; 用于创建新的证书</span></span><br><span class="line"><span class="string"># new  --&gt; 表示创建的是新证书    </span></span><br><span class="line"><span class="string"># x509 --&gt; 表示定义证书的格式为标准格式</span></span><br><span class="line"><span class="string"># key  --&gt; 表示调用的私钥文件信息</span></span><br><span class="line"><span class="string"># out  --&gt; 表示输出证书文件信息</span></span><br><span class="line"><span class="string"># days --&gt; 表示证书的有效期</span></span><br><span class="line"><span class="string"># sha256 --&gt; 加密方式</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#1.开启证书</span></span><br><span class="line"><span class="string">Syntax: ssl on | off;</span></span><br><span class="line"><span class="string">Default:    ssl off;</span></span><br><span class="line"><span class="string">Context:    http, server</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">#2.指定证书文件</span></span><br><span class="line"><span class="string">Syntax: ssl_certificate file;</span></span><br><span class="line"><span class="string">Default:    —</span></span><br><span class="line"><span class="string">Context:    http, server</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">#3.指定私钥文件</span></span><br><span class="line"><span class="string">Syntax: ssl_certificate_key file;</span></span><br><span class="line"><span class="string">Default:    —</span></span><br><span class="line"><span class="string">Context:    http, server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#4.修改nginx配置文件(如果负载均衡配置了就不需要下面的配置了)</span></span><br><span class="line"><span class="string">[root@web01 ~]# cat /etc/nginx/conf.d/https.conf </span></span><br><span class="line"><span class="string">server &#123;</span></span><br><span class="line"><span class="string">    listen 443 ssl;</span></span><br><span class="line"><span class="string">    server_name _;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ssl_certificate /etc/nginx/ssl_key/server.crt;</span></span><br><span class="line"><span class="string">    ssl_certificate_key /etc/nginx/ssl_key/server.key;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    location / &#123;</span></span><br><span class="line"><span class="string">        root /opt/code;</span></span><br><span class="line"><span class="string">        index index.html;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#5.重启nignx服务</span></span><br><span class="line"><span class="string">[root@lb01 ~]# systemctl restart nginx</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#6.测试</span></span><br><span class="line"><span class="string">浏览器访问：https://192.168.15.8/</span></span><br></pre></td></tr></table></figure>

<h4 id="证书加载到代理"><a href="#证书加载到代理" class="headerlink" title="证书加载到代理"></a>证书加载到代理</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将web01的ssl配置同步到代理lb01</span></span><br><span class="line">[root@web01 conf.d]<span class="comment"># scp https.conf 192.168.15.5:/etc/nginx/conf.d/https.conf </span></span><br><span class="line">[root@web01 conf.d]<span class="comment"># scp /etc/nginx/ssl_key 192.168.15.5:/etc/nginx/conf.d/https.conf </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改lb01的nginx配置文件</span></span><br><span class="line">[root@lb01 conf.d]<span class="comment"># cat /etc/nginx/conf.d/https.conf </span></span><br><span class="line">upstream ssl &#123;</span><br><span class="line">    server 172.16.1.7;</span><br><span class="line">    server 172.16.1.8;</span><br><span class="line">    server 172.16.1.9;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name _;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/nginx/ssl_key/server.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl_key/server.key;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://ssl;</span><br><span class="line">        include /etc/nginx/proxy_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name _;</span><br><span class="line">    rewrite (.*) https://192.168.15.5 permanent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试重启nignx服务</span></span><br><span class="line">[root@lb01 ~]<span class="comment"># nginx -t</span></span><br><span class="line">[root@lb01 ~]<span class="comment"># systemctl restart nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">浏览器访问：https://192.168.15.5/</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/linux/" rel="tag"><i class="fa fa-tag"></i> linux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/3cb7076b.html" rel="prev" title="Keepalived高可用">
                  <i class="fa fa-chevron-left"></i> Keepalived高可用
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/a72f05d4.html" rel="next" title="Web服务器-Nginx介绍">
                  Web服务器-Nginx介绍 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">klcc</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">813k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">12:20</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
